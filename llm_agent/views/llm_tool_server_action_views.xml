<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Enhance LLM Tool Form View with Server Action Field -->
    <record id="view_llm_tool_form_server_action" model="ir.ui.view">
        <field name="name">llm.tool.form.server.action</field>
        <field name="model">llm.tool</field>
        <field name="inherit_id" ref="view_llm_tool_form" />
        <field name="arch" type="xml">
            <!-- Add server action field -->
            <xpath expr="//group[1]" position="after">
                <group
          string="Server Action"
          attrs="{'invisible': [('implementation', '!=', 'server_action')]}"
        >
                    <field
            name="server_action_id"
            options="{'no_create': True}"
            domain="[('state', '!=', False)]"
            attrs="{'required': [('implementation', '=', 'server_action')]}"
          />
                </group>
            </xpath>

            <!-- Add a new page for server action tools -->
            <xpath expr="//notebook" position="inside">
                <page
          string="Server Action Settings"
          attrs="{'invisible': [('implementation', '!=', 'server_action')]}"
        >
                    <group>
                        <group string="Audit">
                            <div colspan="2" class="text-muted">
                                All server action executions are logged in the server logs with user information.
                            </div>
                        </group>
                    </group>
                    <div class="alert alert-info" role="alert">
                        <p><strong>How this works:</strong></p>
                        <p
            >This tool is bound to a specific server action. When the LLM calls this tool, it will execute the bound server action.</p>
                        <p>The LLM can provide:</p>
                        <ul>
                            <li><strong
                >record_id</strong>: The ID of the record to operate on</li>
                            <li><strong
                >context</strong>: Additional context variables for the action</li>
                        </ul>
                        <p
            >The schema will be automatically updated based on the bound server action.</p>
                    </div>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
